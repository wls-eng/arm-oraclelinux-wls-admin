{
    "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
    "handler": "Microsoft.Azure.CreateUIDef",
    "version": "0.1.2-preview",
    "parameters": {
        "basics": [
            {
                "name": "dnsLabelPrefix",
                "type": "Microsoft.Common.TextBox",
                "label": "DNS Label Prefix",
                "toolTip": "The string to prepend to the DNS label.",
                "defaultValue": "wls",
                "constraints": {
                    "required": true,
                    "regex": "^[a-z0-9A-Z]{3,10}$",
                    "validationMessage": "The prefix must be between 3 and 10 characters long and contain letters, numbers only."
                }
            },
            {
                "name": "wlsDomainName",
                "type": "Microsoft.Common.TextBox",
                "label": "WebLogic Domain Name",
                "toolTip": "The name of the WebLogic Domain to create.",
                "defaultValue": "adminDomain",
                "constraints": {
                    "required": true,
                    "regex": "^[a-z0-9A-Z]{3,20}$",
                    "validationMessage": "The Domain Name must be between 3 and 20 characters long and contain letters, numbers only."
                },
				{
	                "name": "About",
	                "type": "Microsoft.Common.InfoBox",
	                "options": {
	                    "icon": "None",
	                    "text": "Template version ${project.version}"
	                },
	                "visible": "[bool('${template.version.visible}')]"
	            }
            }
        ],
        "steps": [
            {
                "name": "VirtualMachineConfig",
                "label": "Virtual Machine Settings",
                "subLabel": {
                    "preValidation": "Configure the resources and settings of the virtual machines that comprise the nodes of the WebLogic Domain. ",
                    "postValidation": "Done"
                },
                "bladeTitle": "Node Virtual Machine Settings",
                "elements": [
                    {
                        "name": "vmSizeSelect",
                        "type": "Microsoft.Compute.SizeSelector",
                        "label": "Virtual machine size",
                        "toolTip": "The size of virtual machine to provision.",
                        "recommendedSizes": [
                            "Standard_A1",
                            "Standard_A2",
                            "Standard_A3",
                            "Standard_A4"
                        ],
                        "osPlatform": "Linux",
                        "count": "1"
                    }
                ]
            },
            {
                "name": "Credentials",
                "label": "Credentials for Server Creation",
                "subLabel": {
                    "preValidation": "Provide credentials Required for Server Creation",
                    "postValidation": "Done"
                },
                "bladeTitle": "Credentials for Server Creation",
                "elements": [
                    {
                        "name": "acceptOTNLicenseAgreement",
                        "label": "Accept OTN License Agreement",
                        "type": "Microsoft.Common.TextBox",
                        "tooltip": "A value of N indicates you do not accept the OTN License Agreement.  In that case the deployment will fail.",
                        "defaultValue": "Y",
                        "visible": true,
                        "constraints": {
                            "required": true,
                            "regex": "^[Yy]$",
                            "validationMessage": "The value must be Y/y to proceed with deployment."
                        }
                    },
                    {
                        "name": "adminUsername",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Username for admin account of VMs",
                        "defaultValue": "weblogic",
                        "toolTip": "Use only letters and numbers",
                        "constraints": {
                            "required": true,
                            "regex": "^[a-z0-9A-Z]{1,30}$",
                            "validationMessage": "The value must be 1-30 characters long and must only contain letters and numbers."
                        },
                        "visible": true
                    },
                    {
                        "name": "adminPasswordOrKey",
                        "type": "Microsoft.Common.PasswordBox",
                        "label": {
                            "password": "Password for admin account of VMs",
                            "confirmPassword": "Confirm password"
                        },
                        "toolTip": "Password for admin account of VMs",
                        "constraints": {
                            "required": true,
                            "regex": "^((?=.*[0-9])(?=.*[a-z])(?=.*[A-Z])|(?=.*[0-9])(?=.*[a-z])(?=.*[!@#$%^&*])|(?=.*[0-9])(?=.*[A-Z])(?=.*[!@#$%^&*])|(?=.*[a-z])(?=.*[A-Z])(?=.*[!@#$%^&*])).{12,72}$",
                            "validationMessage": "Password must be at least 12 characters long and have 3 out of the following: one number, one lower case, one upper case, or one special character"
                        },
                        "options": {
                            "hideConfirmation": false
                        },
                        "visible": true
                    },
                    {
                        "name": "otnAccountUsername",
                        "type": "Microsoft.Common.TextBox",
                        "label": "OTN Account Username",
                        "toolTip": "The username of a pre-existing OTN account.",
                        "constraints": {
                            "required": true,
                            "regex": "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$",
                            "validationMessage": "The value must be a valid email address"
                        }
                    },
                    {
                        "name": "otnAccountPassword",
                        "type": "Microsoft.Common.PasswordBox",
                        "label": {
                            "password": "Password for OTN Account",
                            "confirmPassword": "Confirm password"
                        },
                        "toolTip": "Password for OTN Account",
                        "constraints": {
                            "required": true,
                            "validationMessage": "Validation constraints for OTN accounts apply here."
                        },
                        "options": {
                            "hideConfirmation": false
                        },
                        "visible": true
                    },
                    {
                        "name": "wlsUserName",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Username for WebLogic Administrator",
                        "defaultValue": "weblogic",
                        "toolTip": "Use only letters and numbers",
                        "constraints": {
                            "required": true,
                            "regex": "^[a-z0-9A-Z]{1,30}$",
                            "validationMessage": "The value must be 1-30 characters long and must only contain letters and numbers."
                        },
                        "visible": true
                    },
                    {
                        "name": "wlsPassword",
                        "type": "Microsoft.Common.PasswordBox",
                        "label": {
                            "password": "Password for WebLogic Administrator",
                            "confirmPassword": "Confirm password"
                        },
                        "toolTip": "Password for WebLogic Administrator",
                        "constraints": {
                            "required": true,
                            "regex": "^(?=.*[A-Z])(?=.*[a-z])(?=.*\\d)[A-Za-z\\d]{12,}$",
                            "validationMessage": "The password must contain at least 12 characters, with at least 1 uppercase letter, 1 lowercase letter and 1 number."
                        },
                        "options": {
                            "hideConfirmation": false
                        },
                        "visible": true
                    }
                ]
            },
            {
                "name": "Network",
                "label": "Network",
                "subLabel": {
                    "preValidation": "Parameters to customzie network settings",
                    "postValidation": "Done"
                },
                "bladeTitle": "Network",
                "elements": [
                    {
                        "name": "portsToExpose",
                        "label": "Ports and port ranges to expose (N or N-N, comma separated)",
                        "type": "Microsoft.Common.TextBox",
                        "toolTip": "Ports and port ranges to expose (N or N-N, comma separated)",
                        "defaultValue": "80,443,7001-9000",
                        "visible": true,
                        "constraints": {
                            "required": true,
                            "regex": "^((([0-9]+-[0-9]+)|([0-9]+))[,]?)+[^,]$",
                            "validationMessage": "Only numbers, hyphen separated ranges of numbers, separated by commas"
                        }
                    }
                ]
            },
            {
                "name": "AzureActiveDirectoryIntegration",
                "label": "Azure Active Directory Settings",
                "subLabel": {
                    "preValidation": "Configure the Azure Active Directory.",
                    "postValidation": "Done"
                },
                "bladeTitle": "Azure Active Directory Settings",
                "elements": [
                    {
                        "name": "configureAAD",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Configure Azure Active Directory?",
                        "defaultValue": "Yes",
                        "toolTip": "Select 'Yes' and provide required info to configure Azure Active Directory.",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes",
                                    "value": "true"
                                },
                                {
                                    "label": "No",
                                    "value": "false"
                                }
                            ],
                            "required": true
                        }
                    },
                    {
                        "name": "configurationInfo",
                        "type": "Microsoft.Common.Section",
                        "label": "Configuration Information",
                        "visible": "[bool(steps('AzureActiveDirectoryIntegration').configureAAD)]",
                        "elements": [
                            {
                                "name": "addsLDAPInfo",
                                "type": "Microsoft.Common.TextBlock",
                                "options": {
                                    "text": "Please add a security rule to your LDAP server network security group to allow inbound secure LDAP access over TCP port 636 from WebLogic Server after the offer is provisioned. Security threat will be created automatically for you managed domain, it will block WebLogic Server machine to access the LDAP server.",
                                    "link": {
                                        "label": "Learn more",
                                        "uri": "https://docs.microsoft.com/en-us/azure/active-directory-domain-services/tutorial-configure-ldaps#lock-down-secure-ldap-access-over-the-internet"
                                    }
                                }
                            },
                            {
                                "name": "addsNewLDAPInfo",
                                "type": "Microsoft.Common.TextBlock",
                                "options": {
                                    "text": "If you don't have a LDAP server, please create one following the guide.",
                                    "link": {
                                        "label": "Learn more",
                                        "uri": "https://docs.microsoft.com/en-us/azure/active-directory-domain-services/tutorial-configure-ldaps"
                                    }
                                }
                            },
                            {
                                "name": "addsServerHost",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Server Host",
                                "toolTip": "The LDAP server host.",
                                "defaultValue": "ldaps.example.com",
                                "constraints": {
                                    "required": true,
                                    "regex": "(?:[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?\\.)+[a-z0-9][a-z0-9-]{0,61}[a-z0-9]",
                                    "validationMessage": "The value must be a valid host name."
                                }
                            },
                            {
                                "name": "addsPublicIP",
                                "type": "Microsoft.Common.TextBox",
                                "label": "LDAP external IP address",
                                "toolTip": "Secure LDAP external IP address.",
                                "constraints": {
                                    "required": true,
                                    "regex": "\\b((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\\.|$)){4}\\b",
                                    "validationMessage": "The value must be a valid IP address."
                                }
                            },
                            {
                                "name": "aadsPortNumber",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Port",
                                "toolTip": "The port number of LDAP Server, default is 636.",
                                "defaultValue": "636",
                                "constraints": {
                                    "required": true,
                                    "regex": "^[0-9]+$",
                                    "validationMessage": "The value must be numbers."
                                }
                            },
                            {
                                "name": "wlsLDAPProviderName",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Provider Name",
                                "defaultValue": "AzureActiveDirectoryProvider",
                                "toolTip": "The value used for creating authentication provider name of WebLogic Server.",
                                "constraints": {
                                    "required": true,
                                    "regex": "^[a-z0-9A-Z]{3,50}$",
                                    "validationMessage": "The Provider Name must be between 3 and 50 characters long and contain letters, numbers only."
                                }
                            },
                            {
                                "name": "wlsLDAPPrincipal",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Principal",
                                "toolTip": "The Distinguished Name (DN) of the LDAP user that WebLogic Server should use to connect to the LDAP server.",
                                "constraints": {
                                    "required": true,
                                    "regex": ".+,dc|DC=([^,]+),dc|DC=([^,]+)$",
                                    "validationMessage": "The value must be valid LDAP user distinguished name."
                                }
                            },
                            {
                                "name": "wlsLDAPPrincipalPassword",
                                "type": "Microsoft.Common.PasswordBox",
                                "label": {
                                    "password": "Password for Principal",
                                    "confirmPassword": "Confirm password"
                                },
                                "toolTip": "The credential (usually a password) used to connect to the LDAP server.",
                                "constraints": {
                                    "required": true
                                }
                            },
                            {
                                "name": "wlsLDAPUserBaseDN",
                                "type": "Microsoft.Common.TextBox",
                                "label": "User Base DN",
                                "toolTip": "The base distinguished name (DN) of the tree in the LDAP directory that contains users.",
                                "constraints": {
                                    "required": true,
                                    "regex": ".+,dc|DC=([^,]+),dc|DC=([^,]+)$",
                                    "validationMessage": "The value must be valid LDAP user based distinguished name."
                                }
                            },
                            {
                                "name": "wlsLDAPGroupBaseDN",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Group Base DN",
                                "toolTip": "The base distinguished name (DN) of the tree in the LDAP directory that contains groups.",
                                "constraints": {
                                    "required": true,
                                    "regex": ".+,dc|DC=([^,]+),dc|DC=([^,]+)$",
                                    "validationMessage": "The value must be valid LDAP group based distinguished name."
                                }
                            },
                            {
                                "name": "wlsLDAPSSLCertificate",
                                "type": "Microsoft.Common.FileUpload",
                                "label": ".cer Certificate for LDAP",
                                "toolTip": "Client certificate that will be imported to trust store of SSL.",
                                "constraints": {
                                    "required": true,
                                    "accept": ".cer"
                                },
                                "options": {
                                    "multiple": false,
                                    "uploadMode": "binary",
                                    "openMode": "binary",
                                    "encoding": "base64"
                                }
                            }
                        ]
                    }
                ]
            }
        ],
        "outputs": {
            "acceptOTNLicenseAgreement": "[steps('Credentials').acceptOTNLicenseAgreement]",
            "adminPasswordOrKey": "[steps('Credentials').adminPasswordOrKey]",
            "adminUsername": "[steps('Credentials').adminUsername]",
            "dnsLabelPrefix": "[basics('dnsLabelPrefix')]",
            "otnAccountPassword": "[steps('Credentials').otnAccountPassword]",
            "otnAccountUsername": "[steps('Credentials').otnAccountUsername]",
            "portsToExpose": "[steps('Network').portsToExpose]",
            "vmSizeSelect": "[steps('VirtualMachineConfig').vmSizeSelect]",
            "wlsDomainName": "[basics('wlsDomainName')]",
            "wlsPassword": "[steps('Credentials').wlsPassword]",
            "wlsUserName": "[steps('Credentials').wlsUserName]",
            "Location": "[location()]",
            "configureAAD": "[bool(steps('AzureActiveDirectoryIntegration').configureAAD)]",
            "addsServerHost": "[steps('AzureActiveDirectoryIntegration').configurationInfo.addsServerHost]",
            "addsPublicIP": "[steps('AzureActiveDirectoryIntegration').configurationInfo.addsPublicIP]",
            "aadsPortNumber":"[steps('AzureActiveDirectoryIntegration').configurationInfo.aadsPortNumber]",
            "wlsLDAPProviderName":"[steps('AzureActiveDirectoryIntegration').configurationInfo.wlsLDAPProviderName]",
            "wlsLDAPPrincipal":"[steps('AzureActiveDirectoryIntegration').configurationInfo.wlsLDAPPrincipal]",
            "wlsLDAPPrincipalPassword":"[steps('AzureActiveDirectoryIntegration').configurationInfo.wlsLDAPPrincipalPassword]",
            "wlsLDAPUserBaseDN":"[steps('AzureActiveDirectoryIntegration').configurationInfo.wlsLDAPUserBaseDN]",
            "wlsLDAPGroupBaseDN":"[steps('AzureActiveDirectoryIntegration').configurationInfo.wlsLDAPGroupBaseDN]",
            "wlsLDAPSSLCertificate":"[steps('AzureActiveDirectoryIntegration').configurationInfo.wlsLDAPSSLCertificate]"
        }
    }
}